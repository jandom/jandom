---
layout: post
title: Wrapping openbabel in python - using cython
date: '2013-05-27T16:20:00.002-07:00'
author: jandom
tags: 
modified_time: '2013-05-28T15:58:01.125-07:00'
blogger_id: tag:blogger.com,1999:blog-2967594273163880803.post-9055846307572622098
blogger_orig_url: https://jandomanski.blogspot.com/2013/05/openbable-wrapping-in-boost-and-cython.html
---

<link href='http://alexgorbatchev.com/pub/sh/current/styles/shCore.css' rel='stylesheet' type='text/css'/><link href='http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCpp.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCSharp.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCss.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPhp.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushRuby.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushSql.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushVb.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js' type='text/javascript'></script><script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPerl.js' type='text/javascript'></script><script language='javascript'>SyntaxHighlighter.config.bloggerMode = true; SyntaxHighlighter.config.clipboardSwf = 'http://alexgorbatchev.com/pub/sh/current/scripts/clipboard.swf'; SyntaxHighlighter.all(); </script> The <a href="http://jandomanski.blogspot.com/2013/05/wrapping-openbabel-in-python-accessing.html">previous post</a> showed a contrived example of how one could access the openbabel functionality in python using the boost libraries. There is alternative to boost to wrap around c/c++ code, it's called cython. Here is an example openbabel wrapper, exposing some very simple functionality.   Just before diving in, you should know that there already exists a wrapper around openbabel in python (it is called pybel). What I'm showing here doesn't even come close to pybel in terms of usefulness, the idea here is to show a demo of how easy wrapping things in python is.  <pre class="brush: csharp"><br />#! /usr/bin/python<br /><br />from ez_setup import use_setuptools<br />use_setuptools()<br /><br />from setuptools import setup, Extension, find_packages<br />from Cython.Distutils import build_ext<br /><br />import sys, os<br />import glob<br /><br />import subprocess as sub<br /><br />def get_include(name="openbabel"):<br />    p = sub.Popen('locate %s' % name ,stdout=sub.PIPE,stderr=sub.PIPE, shell=True)<br />    output, errors = p.communicate()<br />    include = [str.split("%s%s%s"  %(os.sep, name, os.sep))[0] for str in output.split("\n") if str.endswith(".h")]<br />    <br />    include = set(include)<br />    assert len(include) == 1<br />    <br />    return list(include)[0]<br /><br /><br />def main():<br />    <br />    extensions = [<br />                  Extension('_pyopenbabel',<br />                            glob.glob('src/*.pyx'),<br />                            [get_include('openbabel')],<br />                            language="c++",libraries=['openbabel'])<br />                  ,]<br />    <br />    setup(name              = 'pyopenbabel',<br />          ext_package       = 'pyopenbabel',<br />          cmdclass          = {'build_ext': build_ext},<br />          ext_modules       = extensions,<br />          packages          = find_packages()<br />          )<br />  <br /><br />if __name__ == '__main__':<br />    main()<br /></pre> The actual wrapper is in src/openbabel.pxd. In it you register which things from the openbabel headers you're going to use/wrap. Note that all the "cdef extern from openbabel/..." statements will fail if the inculudes defined in setup.py are not actually pointing to a place where a openbabel headers live. If you want to find out what a header file is, or how to find it - for openbabel or any other piece of code - google will provide a fast soultion.   <pre class="brush: csharp"><br /># distutils: language = c++<br /><br />from libcpp.string cimport string<br /><br />from libcpp cimport bool<br /><br /><br />cdef extern from "openbabel/base.h" namespace "OpenBabel":<br />    cdef cppclass OBBase:<br />        pass<br />    <br />cdef extern from "openbabel/mol.h" namespace "OpenBabel" :<br />    cdef cppclass OBMol(OBBase):<br />        OBMol() except +<br />        const char  *GetTitle(bool replaceNewlines = true)<br />        unsigned int NumAtoms()<br />        OBAtom      *GetAtom(int idx)<br />        <br />cdef extern from "openbabel/atom.h" namespace "OpenBabel":<br />    cdef cppclass OBAtom(OBBase):<br />        double      GetX()<br />        double      GetY()<br />        double      GetZ()<br />        <br />cdef extern from "openbabel/obconversion.h" namespace "OpenBabel" :<br />    cdef cppclass OBConversion:<br />        OBConversion() except +<br />        bool SetInAndOutFormats(const char* inID, const char* outID)<br />        bool SetInFormat(const char* inID)<br />        bool ReadString(OBBase* pOb, string input)<br />        bool ReadFile(OBBase* pOb, string filePath)<br /><br /><br /></pre> We register it's use in src/pyopenbabel.pyx   <script type="syntaxhighlighter" class="brush: csharp"><![CDATA[ cimport openbabel  def HandlePyOBMol(pyMol):     # https://groups.google.com/forum/?fromgroups#!topic/cython-users/YPzCqO4jxlA     cdef long ptr1 = long(pyMol.this)     cdef openbabel.OBMol* optr1 = <openbabel.OBMol*> ptr1     cdef openbabel.OBMol obMol = deref(optr1) # this is the c++ OBMol object     # ... handle further, get/set atoms, bonds, etc  ]]></script> Finally, in pyopenbabel/__init__.py put <pre class="brush: csharp"><br />from _pyopenbabel import *<br /></pre>This will magically import everything from the wrapper (registered as cython extension in setup.py).  Why do I think this is important? Because it's fast, easy and may allow interesting chemistry to happen.  