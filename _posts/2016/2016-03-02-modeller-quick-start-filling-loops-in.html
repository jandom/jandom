---
layout: post
title: Modeller - quick start, filling loops in the DUDE protein receptor structures
date: '2016-03-02T10:43:00.002-08:00'
author: jandom
tags: 
modified_time: '2016-03-02T10:43:50.094-08:00'
blogger_id: tag:blogger.com,1999:blog-2967594273163880803.post-5579484365295001969
blogger_orig_url: https://jandomanski.blogspot.com/2016/03/modeller-quick-start-filling-loops-in.html
---

The aim here was getting simulations of the DUDE receptor proteins up and running. The main challenge is a large number of missing sidechains and loops in these structures - this is not a problem for docking codes perhaps, but certainly is for MD simulation codes. <br /><br />Modeller from the Sali lab seemed like the tool for the job, so let's grab that<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">wget https://salilab.org/modeller/9.16/modeller_9.16-1_amd64.deb</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">sudo env KEY_MODELLER=MODELIRANJE dpkg -i modeller_9.16-1_amd64.deb </span></span>&nbsp; <br /><br />The only useful reference I was able to find on filling loops and missing sidechains was:<br /><br /><a href="https://salilab.org/modeller/wiki/Missing%20residues">https://salilab.org/modeller/wiki/Missing%20residues</a><br /><br />However, it assumes the aligment.ali file is constructed by hand. Maybe that's pleasurable to some but when I have ~20 receptor structures to complete, there is no time for this. Let's automate how alignment.ali file is generated: <br /><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"># alignment.py file</span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">from MDAnalysis import Universe <br />from MDAnalysis.lib.util import convert_aa_code<br />import textwrap, glob<br /><br />u = Universe("receptor.pdb")<br />ca = u.select_atoms("protein and name CA")<br />residues = [(at.resid, at.residue.name) for at in ca]<br />sequence = []<br />for i, (resid, resname) in enumerate(residues):<br />&nbsp;&nbsp;&nbsp; if i: <br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; prev_resid = residues[i-1][0]<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gaps = ["-"]*(resid - prev_resid - 1)<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; sequence.append("".join(gaps))<br />&nbsp;&nbsp;&nbsp; sequence.append(convert_aa_code(resname))<br />seq_gap = "".join(sequence)<br /><br />f = glob.glob("*.fasta.txt")[0]<br />fasta = "".join([l.strip()&nbsp; for l in open(f).readlines() if not l.startswith("&gt;")])<br />seq_filled = fasta[residues[0][0]+2: residues[-1][0]+residues[0][0]+1]<br /><br />print """<br />&gt;P1;receptor<br />structureX:receptor:&nbsp;&nbsp; {0} : :+{1} : :::-1.00:-1.00<br />{2}*<br />&gt;P1;receptor_fill<br />sequence:::::::::<br />{3}*<br />""".format(residues[0][0], len(residues), "\n".join(textwrap.wrap(seq_gap, 73)), "\n".join(textwrap.wrap(seq_filled, 73)))</span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span></span><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"># modeller.py</span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">from modeller import *<br />from modeller.automodel import *&nbsp;&nbsp;&nbsp; # Load the automodel class<br /><br />log.verbose()<br />env = environ()<br /><br /># directories for input atom files<br />env.io.atom_files_directory = ['.', '../atom_files']<br /><br />a = loopmodel(env, alnfile = 'alignment.ali',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; knowns = 'receptor', sequence = 'receptor_fill')<br />a.starting_model= 1<br />a.ending_model&nbsp; = 1<br /><br />a.loop.starting_model = 1<br />a.loop.ending_model&nbsp;&nbsp; = 2<br />a.loop.md_level&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = refine.fast<br /><br />a.make()<br /></span></span>Lastly, that's how it all fits together<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">python alignment.py &gt; alignment.ali</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">python modeller.py</span></span><br /><br />