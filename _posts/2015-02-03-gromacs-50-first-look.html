---
layout: post
title: gromacs 5.0 - first look
date: '2015-02-03T07:34:00.000-08:00'
author: jandom
tags: 
modified_time: '2015-02-03T07:34:03.572-08:00'
thumbnail: http://2.bp.blogspot.com/-T_-GCeqQEwA/VNDpiLTCRVI/AAAAAAAAFZs/kpjmjf3yanc/s72-c/plot.png
blogger_id: tag:blogger.com,1999:blog-2967594273163880803.post-1069748185966218384
blogger_orig_url: https://jandomanski.blogspot.com/2015/02/gromacs-50-first-look.html
---

Oh, gromacs, old friend let's see what you have to offer in your new release<br /><br /><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">wget ftp://ftp.gromacs.org/pub/gromacs/gromacs-5.0.4.tar.gz<br />tar xvf gromacs-5.0.4.tar.gz</span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">cd gromacs-5.0.4</span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">mkdir build</span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">cd build </span></span><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">cmake ..&nbsp;</span></span><br /><br />Problem #1<br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span></span><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">-- Could NOT find LibXml2 (missing:&nbsp; LIBXML2_LIBRARIES LIBXML2_INCLUDE_DIR) <br />CMake Warning at CMakeLists.txt:601 (message):<br />&nbsp; libxml2 not found.&nbsp; Will build GROMACS without unit-tests.&nbsp; This is not<br />&nbsp; recommended, because the unit-tests help to verify that GROMACS functions<br />&nbsp; correctly.&nbsp; Most likely you are missing the libxml2-dev(el) package.&nbsp; After<br />&nbsp; you installed it, set GMX_BUILD_UNITTESTS=ON.</span></span><br /><br /><br />Problem #2<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">CMake Warning at cmake/gmxManageFFTLibraries.cmake:94 (message):<br />&nbsp; The FFTW library was compiled with --enable-avx to enable AVX SIMD<br />&nbsp; instructions.&nbsp; That might sound like a good idea for your processor, but<br />&nbsp; for FFTW versions up to 3.3.3, these are slower than the SSE/SSE2 SIMD<br />&nbsp; instructions for the way GROMACS uses FFTs.&nbsp; Limitations in the way FFTW<br />&nbsp; allows GROMACS to measure performance make it awkward for either GROMACS or<br />&nbsp; FFTW to make the decision for you based on runtime performance.&nbsp; You should<br />&nbsp; compile a different FFTW library with --enable-sse or --enable-sse2.&nbsp; If<br />&nbsp; you have a more recent FFTW, you may like to compare the performance of<br />&nbsp; GROMACS with FFTW libraries compiled with and without --enable-avx.<br />&nbsp; However, the GROMACS developers do not really expect the FFTW AVX<br />&nbsp; optimization to help, because the performance is limited by memory access,<br />&nbsp; not computation.<br />Call Stack (most recent call first):<br />&nbsp; CMakeLists.txt:738 (include)</span></span><br /><br /><br /><br /><br />Problem #1 is easy, at least on Ubuntu 14.04<br /><br /><span style="font-size: x-small;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sudo apt-get install libboost-dev libxml2-dev</span></span><br /><br />For Problem #2, we'll just ask gromacs to compile it's own FFTW. Additionally the built will be done in single precision with GPU support<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"><br /></span></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">cmake .. -DGMX_GPU=on -DGMX_DOUBLE=off -DGMX_BUILD_OWN_FFTW=ON</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">make -j40</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">make install </span></span><br /><br />Warning: i'm not sure if at this stage I need to worry about OpenMP vs MPI. All runs will be single node, to test the GPU code, so I'm going to ignore the MPI, which in my understanding is only used for inter-node simulations?<br /><br />Good, let's compile an equivalent version of the gromacs 4.6.7 and compare the two creatures. The expectation is that the performance is not drastically different. The way we measure the performance is by taking a number of water boxes of increasing size.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-T_-GCeqQEwA/VNDpiLTCRVI/AAAAAAAAFZs/kpjmjf3yanc/s1600/plot.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-T_-GCeqQEwA/VNDpiLTCRVI/AAAAAAAAFZs/kpjmjf3yanc/s1600/plot.png" height="320" width="320" /></a></div>With a single K20 GPU and 40 OpenMP threads, the GPU is grossly overworked. By chemical terminology those are "CPU-saturating conditions". With that caveat the performance is not mind blowing - for a chemically meaningful system size 10^4-10^5 it's around 20 ns/day but K20 is not exactly 'top of the line'.<br /><br /><br /><br />