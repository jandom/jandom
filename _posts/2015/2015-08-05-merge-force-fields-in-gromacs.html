---
layout: post
title: Merge force-fields in gromacs
date: '2015-08-05T13:49:00.001-07:00'
author: jandom
tags: 
modified_time: '2016-02-04T13:03:34.498-08:00'
blogger_id: tag:blogger.com,1999:blog-2967594273163880803.post-1725196667811284420
blogger_orig_url: https://jandomanski.blogspot.com/2015/08/merge-force-fields-in-gromacs.html
---

Using gromacs with two force-fields are for ligand one for protein? Wanting to do that but not knowing how? Look no further.<br /><br />The technical problem is as follows: let's say you have your favourite custom force-field. For me it resides in charmm.ff and it's my hybrid charmm36+charmm22* set of parameters.<br /><br />To simulate a ligand inside of a system parametrized using the ff-above, I went to paramchem.org and obtained small molecule parameters for my ligand. These were in CHARMM format, so (courtesy of <a href="http://mackerell.umaryland.edu/">Alex Mackerell</a>) I converted those to gromacs itp files. That left me with a dependency on <a href="http://mackerell.umaryland.edu/download.php?filename=CHARMM_ff_params_files/charmm36-jun2015.ff.tgz" title="CHARMM_ff_params_files/charmm36-jun2015.ff.tgz">charmm36-jun2015.ff.tgz</a><br /><br />There is only a handful of lines I want from charmm36-jun2015.ff, the ligand is very simple. There is no easy way to get those out, or to merge my custom charmm with Alex's.<br /><br /><b>Prerequisites</b><br /><br />Install networkx, a python package for dealing with graphs<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"> pip install networkx</span><br />Let's take some example ligand molecules, such as the TPP - the ligand for EmrE drug transporter. Attached <a href="https://drive.google.com/file/d/0BzI3NK6qw0lJUF9fOWxKajk3TTQ/view?usp=sharing">here</a>, after protonating it in maestro. <br /><br /><b>First iteration, the fast way</b><br /><br />On paramchem.org, select the checkbox "Include parameters that are already in CGenFF" in paramchem to include copies of the parameters in the paramchem output. This removes the dependency on charmm36-jun2015 - everything needed is explicitly copied into the .str and then the .prm files. Then directly include the .prm into your force-filed and done.<br /><br /><b>Second interaction, the clever way</b><br /><br />Instead of downloading an .str with all the parameters explicitly included, we'll take it the default way. Then we're going to use our own code to extract the parameters for the isolated component in the system. The end result is the same: a stand-alone itp with all the parameters for a given molecule of interest.<br /><br /><b> </b><br /><b> </b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">python cgenff_charmm2gmx.py Ligand Ligand.mol2 Ligand.str charmm36-jun2015.ff</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">grompp -pp -p ligand.top</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># exctract only the parameters needed from processed.top<br />python forcefield.py processed.top processed.itp</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;"><span style="font-family: inherit;">The script<span style="font-family: inherit;"> <a href="https://github.com/jandom/GromacsWrapper/blob/develop/scripts/gw-forcefield.py">forcefield.py</a> be do<span style="font-family: inherit;">wnloaded from github&nbsp;</span></span></span></span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">processed.itp contains only the parameters needed to run this ligand molecul<span style="font-family: inherit;">e<span style="font-family: inherit;">: append all the [ *types ] sections to your ffbonded.itp and ffnonbond<span style="font-family: inherit;">.itp, then<span style="font-family: inherit;"> </span></span></span></span>#include <span style="font-family: inherit;">the reminder of processed.itp<span style="font-family: inherit;"> in your</span></span> topol.top and fly off with your simulations. With any force-field. </span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;"><b>Advantages of the slow way - separation of parameters</b></span><br /><br /><span style="font-family: inherit;">Using forcefield.py you could obtain molecule.itp file<b> </b>for your lipid, protein and small molecule parameters<span style="font-family: inherit;"> -</span> potentially using 3 different force-fields. These can then be sanely combined together and used in simulation. How to combine will&nbsp; be the topic of the next entry. </span><br /><br /><br /><span style="font-family: inherit;"></span><br /><span style="font-family: inherit;"><b><br /></b></span><b><span style="font-family: inherit;"> </span></b>