---
layout: post
title: What was that password again?
date: '2016-09-23T13:25:00.002-07:00'
author: jandom
tags: 
modified_time: '2016-09-23T13:25:55.283-07:00'
blogger_id: tag:blogger.com,1999:blog-2967594273163880803.post-6141891700512365036
blogger_orig_url: https://jandomanski.blogspot.com/2016/09/what-was-that-password-again.html
---

A few months ago I bought a new hard-drive. When you encrypt a drive, you need to set a password – but the trick here is to remember the password. Your hard-drive won't send you a "forgot password?" email. So you set that password, enter it, the drive mounts and then you work away happily for weeks without rebooting your machine.<br /><br />Then you reboot... and you need to re-enter that password.<br /><br />You slowly realize that those weeks ago you set a new unique password for that bloody hard-drive that you don't remember for the love of god... What to do? Well one, don't be a complete idiot like me – remember the password. But if you do, here is what to do? [Spoiler alert: I failed to recover the password but it's a pretty interesting ride...]<br /><br />The new Ubuntu 16.04 comes with this handy too called 'bruteforce-luks', here are some scenarios. Note you have to use it as root.<br /><br /><b>"I remember the start/end of the password and I sort of know what's in the middle"</b><br /><br />Here is what you can try, where the -b and -e are the starts and end of the password are known. -t is the number of CPU threads to use. -l and -m are the lower and maximum length of the password. -s is the set of characters you wanna use to crack.<br /><br /><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">sudo bruteforce-luks -b SomeStart -t 4 -l 9 -m 14 -s 0123456789&nbsp; /dev/sdc1</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;"><br /></span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;"></span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">sudo bruteforce-luks -e SomeEnd -t 4 -l 9 -m 14 -s 0123456789&nbsp; /dev/sdc1</span></div><br />The device /dev/sdc1 maybe different in your case. To check progress of this brute-force scan use<br /><br /><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">pkill -USR1 -f bruteforce-luks</span></div><br /><b>"I have no idea what the password is but my passwords are usually made up of some tokens"</b><br /><b><br /></b>Worry not! That actually drastically reduces the search space and gives you a fair chance of success! Let's assume your tokens are: cats, dogs, elephants. We're gonna generate a list of all the permutations of those with a simple python script<br /><br /><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">import itertools</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal; min-height: 13px;"><span style="font-variant-ligatures: no-common-ligatures;"></span><br /></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">tokens = ["cats", "dogs", "elephants"]</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal; min-height: 13px;"><span style="font-variant-ligatures: no-common-ligatures;"></span><br /></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">results = []</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal; min-height: 13px;"><span style="font-variant-ligatures: no-common-ligatures;"></span><br /></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">for L in range(0, 6):</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">&nbsp; &nbsp; &nbsp; &nbsp; for subset in itertools.permutations(tokens, L):</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; results.append(subset)</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal; min-height: 13px;"><span style="font-variant-ligatures: no-common-ligatures;"></span><br /></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">with open("bruteforce-luks.txt", "w") as f:</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">&nbsp; &nbsp; lines = ["".join(r) for r in results][1:]</span></div><br /><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">&nbsp; &nbsp; f.write("\n".join(lines))</span></div><div><span style="font-variant-ligatures: no-common-ligatures;"><br /></span></div><div>Here is how this file looks like</div><div><br /></div><div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">$ python bruteforce-luks.py</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;">$ head bruteforce-luks.txt&nbsp;</div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">cats</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">dogs</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">elephants</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">catsdogs</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">catselephants</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">dogscats</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">dogselephants</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">elephantscats</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">elephantsdogs</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">catsdogselephants</span></div></div><div><span style="font-variant-ligatures: no-common-ligatures;"><br /></span></div><div>With that list of possible passwords you can then&nbsp;</div><div><br /></div><div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">sudo bruteforce-luks -t 6 -f bruteforce-luks.txt /dev/sdc1</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;"><br /></span></div>-f passes the file list, -t tell how many CPU threads to use. The device /dev/sdc1 maybe different in your case. To check progress of this brute-force scan use<br /><br /><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;"></span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;">pkill -USR1 -f bruteforce-luks</span></div><div style="font-family: Menlo; font-size: 11px; line-height: normal;"><span style="font-variant-ligatures: no-common-ligatures;"><br /></span></div><b>Epilog</b><br /><b><br /></b>While I ultimately failed to recover the hard-drive, I hope this guide will help some people get out a little disaster like that.&nbsp;</div><div><span style="font-variant-ligatures: no-common-ligatures;"><br /></span></div>